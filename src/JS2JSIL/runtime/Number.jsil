import Internals.jsil;

(* ****************** *)
(* THE NUMBER LIBRARY *)
(* ****************** *)

(* *** CALL *** *)

proc Number_call (xsc, vthis, v) {
			la := args;
			len := l-len (la);

			goto [len < 3] zero rlab;

	zero:	v := 0;

	rlab:	xret := "i__toNumber" (v) with elab;
	elab:	skip
}
with
{
	ret: xret, rlab;
	err: xret, elab;
};

(* *** CONSTRUCT *** *)

proc Number_construct (xsc, vthis, v) {
			la := args;
			len := l-len (la);

			goto [len < 3] zero init;

	zero:	v := 0;

	init:	pv := "i__toNumber" (v) with elab;

			xret := new ();
			xret := "create_default_object" (xret, $lnum_proto, "Number", true);

			m := metadata(xret);
			[m, "@primitiveValue"] := pv;

	rlab:	skip;
	elab:	skip
}
with
{
	ret: xret, rlab;
	err: pv, elab;
};

(* *** VALUEOF *** *)

proc NP_valueOf (xsc, vthis) {
			goto [typeOf (vthis) = Num] num ionum;
	num:	xret := vthis;
			goto rlab;

	ionum:	goto [typeOf (vthis) = Obj] onum throw;
	onum:	m := metadata(vthis);
			xret := [m, "@class"];
			goto [xret = "Number"] retnum throw;
	retnum:	xret := [m, "@primitiveValue"];

	rlab:	skip;

	throw:	xret := "TypeError" ();
	elab:	skip
}
with
{
	ret: xret, rlab;
	err: xret, elab;
};

(* *** TOSTRING *** *)

proc NP_toString (xsc, vthis, radix) {
			goto [typeOf (vthis) = Num] num ionum;
	num:	xret := vthis;
			goto retstr;

	ionum:	goto [typeOf (vthis) = Obj] onum throw;
	onum:	m := metadata(vthis);
			xret := [m, "@class"];
			goto [xret = "Number"] retnum throw;
	retnum:	xret := [m, "@primitiveValue"];
	retstr:	xret := num_to_string (xret);

	rlab:	skip;

	throw:	xret := "TypeError" ();
	elab:	skip
}
with
{
	ret: xret, rlab;
	err: xret, elab;
};
